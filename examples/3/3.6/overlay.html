<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Input with Blocking Overlay</title>
  <style>
    :root{--bg:#f5f7fb;--card:#ffffff;--accent:#0366d6}
    html,body{height:100%}
    body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;display:flex;align-items:center;justify-content:center}
    .page{width:100%;max-width:640px;padding:24px}
    .card{background:var(--card);padding:24px;border-radius:10px;box-shadow:0 6px 20px rgba(16,24,40,0.08)}
    label{display:block;margin-bottom:8px;font-weight:600}
    input[type="text"]{width:100%;padding:10px 12px;font-size:16px;border:1px solid #d6dbe4;border-radius:6px}
    .controls{margin-top:12px;display:flex;gap:8px}
    button{background:var(--accent);color:#fff;border:0;padding:10px 14px;border-radius:6px;cursor:pointer;font-weight:600}
    button.secondary{background:#6b7280}

    /* Overlay styles */
    .overlay{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:flex;align-items:center;justify-content:center;z-index:9999}
    .overlay .modal{background:#fff;padding:20px 22px;border-radius:10px;max-width:420px;width:90%;box-shadow:0 10px 40px rgba(2,6,23,0.35);text-align:center}
    .overlay .modal h2{margin:0 0 10px;font-size:20px}
    .overlay .modal p{margin:0 0 18px;color:#333}
    .overlay .modal button{width:120px}
  </style>
</head>
<body>
  <main class="page">
    <section class="card" aria-labelledby="title">
      <h1 id="title">Blocking Overlay Demo</h1>
      <p>Type something in the field, then click <strong>Open Overlay</strong> â€” the overlay will cover and block the input.</p>
      <div>
        <label for="textInput">Your text</label>
        <input id="textInput" type="text" placeholder="Try typing here" autocomplete="off">
      </div>
      <div class="controls">
        <button id="openOverlay">Open Overlay</button>
        <button class="secondary" id="focusInput">Focus Input</button>
      </div>
    </section>
  </main>

  <script>
    const openBtn = document.getElementById('openOverlay');
    const input = document.getElementById('textInput');
    const focusBtn = document.getElementById('focusInput');

    focusBtn.addEventListener('click', () => input.focus());

    openBtn.addEventListener('click', () => {
      // Create overlay
      const overlay = document.createElement('div');
      overlay.id = 'pageOverlay';
      overlay.className = 'overlay';
      overlay.setAttribute('role','dialog');
      overlay.setAttribute('aria-modal','true');

      // Build modal content
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.innerHTML = `
        <h2 id="overlayTitle">Overlay Active</h2>
        <p>The overlay blocks interaction with the page below. Click Close to remove it.</p>
      `;

      const closeBtn = document.createElement('button');
      closeBtn.id = 'overlayCloseBtn';
      closeBtn.setAttribute('aria-label','Close overlay');
      closeBtn.textContent = 'Close';

      // Collect and disable background interactive elements to prevent both user and typical automation interaction
      const interactiveSelector = 'input,textarea,select,button,a[href],[tabindex]';
      const allInteractive = Array.from(document.querySelectorAll(interactiveSelector)).filter(el => !modal.contains(el));
      // We'll filter out elements that will be inside the overlay (none yet) and mark/disable the rest
      const toDisable = allInteractive.filter(el => !overlay.contains(el));
      toDisable.forEach(el => {
        // remember previous state
        el.dataset._overlayPrevDisabled = el.hasAttribute('disabled') ? 'true' : 'false';
        if (el.hasAttribute('tabindex')) el.dataset._overlayPrevTabindex = el.getAttribute('tabindex');
        // set inert-like behavior
        try{ el.inert = true } catch(e){}
        el.setAttribute('disabled','');
        el.setAttribute('tabindex','-1');
      });

      closeBtn.addEventListener('click', () => {
        // restore previously-disabled elements
        toDisable.forEach(el => {
          if (el.dataset._overlayPrevDisabled === 'false') el.removeAttribute('disabled');
          if (el.dataset._overlayPrevTabindex !== undefined) {
            el.setAttribute('tabindex', el.dataset._overlayPrevTabindex);
            delete el.dataset._overlayPrevTabindex;
          } else {
            el.removeAttribute('tabindex');
          }
          try{ el.inert = false } catch(e){}
          delete el.dataset._overlayPrevDisabled;
        });

        document.body.removeChild(overlay);
        document.body.style.overflow = '';
        input.focus();
      });

      modal.appendChild(closeBtn);
      overlay.appendChild(modal);

      // Prevent background scrolling while overlay is present
      document.body.style.overflow = 'hidden';

      document.body.appendChild(overlay);

      // Move focus to the close button for accessibility
      closeBtn.focus();
    });
  </script>
</body>
</html>
